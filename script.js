// Initialize chart variable
let statisticsChart = null;

// Hex dictionary for result lookup
const hexDict = {
    '000000': 2, '100000': 23, '010000': 8, '110000': 20, '001000': 45, '101000': 35,
    '011000': 41, '111000': 12, '000001': 24, '100001': 27, '010001': 3, '110001': 42,
    '001001': 51, '101001': 21, '011001': 17, '111001': 25, '000010': 7, '100010': 4,
    '010010': 29, '110010': 59, '001010': 40, '101010': 64, '011010': 47, '111010': 6,
    '000011': 19, '100011': 41, '010011': 60, '110011': 61, '001011': 54, '101011': 38,
    '011011': 58, '111011': 10, '000100': 15, '100100': 52, '010100': 39, '110100': 53,
    '001100': 62, '101100': 56, '011100': 31, '111100': 33, '000101': 36, '100101': 22,
    '010101': 63, '110101': 37, '001101': 55, '101101': 30, '011101': 49, '111101': 13,
    '000110': 46, '100110': 18, '010110': 48, '110110': 57, '001110': 32, '101110': 50,
    '011110': 28, '111110': 44, '000111': 11, '100111': 26, '010111': 5, '110111': 9,
    '001111': 34, '101111': 14, '011111': 43, '111111': 1
};

const ichingData = {
    "trigrams": [
        {"id": 0, "name": "坤", "pinyin": "Kun", "binary": "000", "code": '\u2637'},
        {"id": 1, "name": "震", "pinyin": "Zhen", "binary": "001", "code": '\u2633'},
        {"id": 2, "name": "坎", "pinyin": "Kan", "binary": "010", "code": '\u2635'},
        {"id": 3, "name": "兌", "pinyin": "Dui", "binary": "011", "code": '\u2631'},
        {"id": 4, "name": "艮", "pinyin": "Gen", "binary": "100", "code": '\u2636'},
        {"id": 5, "name": "離", "pinyin": "Li", "binary": "101", "code": '\u2632'},
        {"id": 6, "name": "巽", "pinyin": "Xun", "binary": "110", "code": '\u2634'},
        {"id": 7, "name": "乾", "pinyin": "Qian", "binary": "111", "code": '\u2630'}
    ],
    "hexagrams": [
        {"id": 1, "name": "乾", "pinyin": "Qian", "symbol": "乾上乾下", "trigram_upper": 7, "trigram_lower": 7, "short": "乾為天", "ci": "元亨利貞。", "ci_white": "大吉亨通，有利於正固。", "yao_white": [
            "初九：潛龍勿用。（白話：龍潛伏在深淵中，不要行動，時機未到。）",
            "九二：見龍在田，利見大人。（白話：龍現身於田野，有利於見到有才能的大人。）",
            "九三：君子終日乾乾，夕惕若，厲無咎。（白話：君子整天勤勉奮發，晚上還警惕戒慎，雖有危險但無過錯。）",
            "九四：或躍在淵，無咎。（白話：或躍進深淵，或潛伏不動，無過錯。）",
            "九五：飛龍在天，利見大人。（白話：龍飛翔於天上，有利於見到有才能的大人。）",
            "上九：亢龍有悔。（白話：龍飛得太高就會後悔。）"
        ]},
        {"id": 2, "name": "坤", "pinyin": "Kun", "symbol": "坤上坤下", "trigram_upper": 0, "trigram_lower": 0, "short": "坤為地", "ci": "元亨。利牝馬之貞。君子有攸往，先迷後得主，利。西南得朋，東北喪朋。安貞吉。", "ci_white": "大吉亨通，有利於婦女的正固。君子有所往，先迷後得主，有利。西南得朋，東北失朋。安於正固吉。", "yao_white": [
            "初六：履霜，堅冰至。（白話：踩到霜，堅冰就要來臨，隱患將現。）",
            "六二：直方大，不習無不利。（白話：正直、方正、寬大，不需學習就無不利。）",
            "六三：含章可貞，或從王事，無成有終。（白話：含藏美德可正固，或從事王事，雖無大成但有善終。）",
            "六四：括囊，無咎無譽。（白話：像繫緊口袋一樣謹慎，無過錯也無讚譽。）",
            "六五：黃裳元吉。（白話：穿黃色下裳，大吉。）",
            "上六：龍戰於野，其血玄黃。（白話：龍在野外互相爭戰，流出的血黑黃交雜。）"
        ]},
        {"id": 3, "name": "屯", "pinyin": "Zhun", "symbol": "坎上震下", "trigram_upper": 2, "trigram_lower": 1, "short": "水雷屯", "ci": "元亨利貞。勿用有攸往，利建侯。", "ci_white": "大吉亨通有利於正固。不要外出，有利於建立諸侯。", "yao_white": [
            "初九：磐桓，利居貞，利建侯。（白話：徘徊不前，有利居處正固，有利建立諸侯。）",
            "六二：屯如邅如，乘馬班如。匪寇婚媾，女子貞不字，十年乃字。（白話：艱難徘徊，馬匹奔馳不定。不是強盜而是求婚，女子正固不嫁，十年後才嫁。）",
            "六三：即鹿無虞，惟入於林中，君子幾不如舍，往吝。（白話：追鹿無導師，只進入林中，君子幾乎不如放棄，前進有悔。）",
            "六四：乘馬班如，求婚媾，往吉，無不利。（白話：馬匹奔馳不定，求婚前進吉，無不利。）",
            "九五：屯其膏，小貞吉，大貞凶。（白話：屯難中潤澤，小正固吉，大正固凶。）",
            "上六：乘馬班如，泣血漣如。（白話：馬匹奔馳不定，哭泣流血連綿。）"
        ]},
        {"id": 4, "name": "蒙", "pinyin": "Meng", "symbol": "艮上坎下", "trigram_upper": 4, "trigram_lower": 2, "short": "山水蒙", "ci": "亨。匪我求童蒙，童蒙求我。初筮告，再三瀆，瀆不告。利貞。", "ci_white": "亨通。不是我求蒙昧的童子，而是童子求我。初次求問有應，再三求問則玷污了，不再應。利於正固。", "yao_white": [
            "初六：發蒙，利用刑人，用說桎梏。以往吝。（白話：開啟蒙昧，利用懲治人，用以解除桎梏。前進有悔。）",
            "九二：包蒙吉。納婦吉。子克家。（白話：包容蒙昧吉。娶妻吉。兒子能治家。）",
            "六三：勿用取女，見金夫，不有躬。無攸利。（白話：不要娶這樣的女子，見到有錢人就失身，無所利。）",
            "六四：困蒙，吝。（白話：困於蒙昧，有悔。）",
            "六五：童蒙吉。（白話：童蒙吉利。）",
            "上九：擊蒙，不利為寇，利禦寇。（白話：擊打蒙昧，不利為寇，有利抵禦寇。）"
        ]},
        {"id": 5, "name": "需", "pinyin": "Xu", "symbol": "坎上乾下", "trigram_upper": 2, "trigram_lower": 7, "short": "水天需", "ci": "有孚，光亨，貞吉。利涉大川。", "ci_white": "有誠信，光大亨通，正固吉利。有利於渡過大河。", "yao_white": [
            "初九：需于郊，利用恒，無咎。（白話：等待於郊外，利用恆心，無過錯。）",
            "九二：需于沙，小有言，終吉。（白話：等待於沙灘，小有議論，終於吉。）",
            "九三：需于泥，致寇至。（白話：等待於泥濘，引致寇賊來臨。）",
            "六四：需于血，出自穴。（白話：等待於血泊，從穴中脫出。）",
            "九五：需于酒食，貞吉。（白話：等待於酒食，正固吉。）",
            "上六：入于穴，有不速之客三人來，敬之終吉。（白話：進入穴中，有不速之客三人來，恭敬對待終吉。）"
        ]},
        {"id": 6, "name": "訟", "pinyin": "Song", "symbol": "乾上坎下", "trigram_upper": 7, "trigram_lower": 2, "short": "天水訟", "ci": "有孚窒。惕中吉。終凶。利見大人，不利涉大川。", "ci_white": "有誠信但受阻。警惕中吉。終於凶。有利見大人，不利渡大河。", "yao_white": [
            "初六：訟，元吉。或不食去，往有尚。（白話：訟告，大吉。或不食而離去，前進有功。）",
            "九二：不克訟，歸而逋，其邑人三百戶，無眚。（白話：不能勝訟，歸而逃，其邑人三百戶，無災。）",
            "六三：食舊德，貞厲，終吉，或從王事，無成。（白話：食舊德，正固危險，終吉，或從王事，無大成。）",
            "九四：訟不克，復即命渝，安貞吉。（白話：訟不勝，復歸命令，變更安於正固吉。）",
            "九五：訟，元吉。（白話：訟告，大吉。）",
            "上九：或錫之鞶帶，終朝三褫之。（白話：或賜以鞶帶，早晨三次褫奪。）"
        ]},
        {"id": 7, "name": "師", "pinyin": "Shi", "symbol": "坎上坤下", "trigram_upper": 2, "trigram_lower": 0, "short": "地水師", "ci": "貞，丈人吉，无咎。", "ci_white": "正固，長者吉，無咎。", "yao_white": [
            "地之眾以媚人之善，言必有證，以定其信。故《易》曰「師貞，丈人吉」。" ,
            "初六：師出以律，貞凶，無咎。（白話：師出以法，正固凶，無咎。）",
            "六二：師中，熊虎相仇，師災。（白話：師中，熊虎相仇，師有災。）",
            "六三：師或輿屍，凶。（白話：師或載屍，凶。）",
            "六四：師左次，無咎。（白話：師左次，無咎。）",
            "六五：田有禽，利執言，無咎。長子帥師，弟子輿屍，貞凶。（白話：田有禽，利執言，無咎。長子帥師，弟子載屍，正固凶。）",
            "上六：大君有命，開國承家，小人勿用。（白話：大君有命，開國承家，小人勿用。）"
        ]},
        {"id": 8, "name": "比", "pinyin": "Bi", "symbol": "坤上坎下", "trigram_upper": 0, "trigram_lower": 2, "short": "水地比", "ci": "吉。原筮元永貞,无咎。不寧方來，後夫凶。", "ci_white": "吉。初筮元始永遠正固，無咎。不安的遠方來歸附，遲來者凶。", "yao_white": [
            "初六：有孚比之，無咎。有孚盈缶，終來有它，吉。（白話：有誠信親比之，無咎。有誠信盈滿缶，終來有他，吉。）",
            "六二：比之自內，貞吉。（白話：從內親比，正固吉。）",
            "六三：比之匪人。（白話：親比非人。）",
            "六四：外比之，貞吉。（白話：從外親比，正固吉。）",
            "九五：顯比，王用三驅，失前禽，邑人不誡，吉。（白話：顯著親比，王用三驅，失前禽，邑人不戒，吉。）",
            "上六：比之無首，凶。（白話：親比無首，凶。）"
        ]},
        {"id": 9, "name": "小畜", "pinyin": "Xiao Chu", "symbol": "巽上乾下", "trigram_upper": 6, "trigram_lower": 7, "short": "風天小畜", "ci": "亨。密雲不雨，自我西郊。", "ci_white": "亨通。密雲不雨，從我西方郊外而來。", "yao_white": [
            "初九：復自道，何其咎，吉。（白話：復歸正道，何過之有，吉。）",
            "九二：牽復，吉。（白話：牽引復歸，吉。）",
            "九三：輿說輻，夫妻反目。（白話：車輿脫輻，夫妻反目。）",
            "六四：有孚，血去惕出，無咎。（白話：有誠信，血去警惕出，無咎。）",
            "九五：有孚攣如，富以其鄰。（白話：有誠信攣如，富以其鄰。）",
            "上九：既雨既處，尚德載，婦貞厲，月幾望，君子征凶。（白話：既雨既處，尚德載，婦正固危險，月幾望，君子征凶。）"
        ]},
        {"id": 10, "name": "履", "pinyin": "Lü", "symbol": "乾上兌下", "trigram_upper": 7, "trigram_lower": 3, "short": "天澤履", "ci": "履虎尾，不咥人，亨。", "ci_white": "踐虎尾，不咬人，亨通。", "yao_white": [
            "初九：素履，往無咎。（白話：素履，前進無咎。）",
            "九二：履道坦坦，幽人貞吉。（白話：履道坦坦，幽人正固吉。）",
            "六三：眇能視，跛能履，履虎尾，咥人，凶。武人為于大君。（白話：眇能視，跛能履，履虎尾，咬人，凶。武人為於大君。）",
            "九四：履虎尾，愬愬，終吉。（白話：履虎尾，惶恐，終吉。）",
            "九五：夬履，貞厲。（白話：決然履，正固危險。）",
            "上九：視履考祥，其旋元吉。（白話：視履考祥，其旋元吉。）"
        ]},
        {"id": 11, "name": "泰", "pinyin": "Tai", "symbol": "坤上乾下", "trigram_upper": 0, "trigram_lower": 7, "short": "地天泰", "ci": "小往大來，吉亨。", "ci_white": "小往大來，吉亨。", "yao_white": [
            "初九：拔茅茹，以其彙，征吉。（白話：拔茅茹，以其彙，征吉。）",
            "九二：包荒，用馮河，不遐遺，朋亡，得尚于中行。（白話：包荒，用馮河，不遐遺，朋亡，得尚于中行。）",
            "九三：無平不陂，無往不復。艱貞無咎，勿恤其孚，于食有福。（白話：無平不陂，無往不復。艱貞無咎，勿恤其孚，于食有福。）",
            "六四：翩翩，不富以其鄰，不戒以孚。（白話：翩翩，不富以其鄰，不戒以孚。）",
            "六五：帝乙歸妹，以輔顒真，吉。（白話：帝乙歸妹，以輔顒真，吉。）",
            "上六：城復于隍，勿用師，自邑告命，貞吝。（白話：城復于隍，勿用師，自邑告命，貞吝。）"
        ]},
        {"id": 12, "name": "否", "pinyin": "Pi", "symbol": "乾上坤下", "trigram_upper": 7, "trigram_lower": 0, "short": "天地否", "ci": "天地不交，否。君子以儉德辟難，不可榮以祿。", "ci_white": "天地不交而閉塞。君子以儉約的德行避難，不可因榮華而受祿。", "yao_white": [
            "初六：拔茅茹，以其彙，貞吉亨。（白話：拔茅茹，以其彙，正固吉亨。）",
            "六二：包承，小人吉，大人否，亨。（白話：包承，小人吉，大人否，亨。）",
            "六三：包羞。（白話：包羞。）",
            "九四：有命無咎，疇離祉。（白話：有命無咎，疇離祉。）",
            "九五：休否，大人吉。其亡其亡，系于苞桑。（白話：休否，大人吉。其亡其亡，系于苞桑。）",
            "上九：傾否，先否後喜。（白話：傾否，先否後喜。）"
        ]},
        {"id": 13, "name": "同人", "pinyin": "Tong Ren", "symbol": "乾上離下", "trigram_upper": 7, "trigram_lower": 5, "short": "天火同人", "ci": "同人于野，亨。利涉大川，利君子貞。", "ci_white": "與人同心於野外，亨通。有利渡大河，有利君子正固。", "yao_white": [
            "初九：同人于門，無咎。（白話：同人於門，無咎。）",
            "六二：同人于宗，吝。（白話：同人於宗，吝。）",
            "九三：伏戎于莽，升其高陵，三歲不興。（白話：伏戎於莽，升其高陵，三歲不興。）",
            "九四：乘其墉，弗克攻，吉。（白話：乘其墉，弗克攻，吉。）",
            "九五：同人，先號咷而後笑，大師克相遇。（白話：同人，先號咷而後笑，大師克相遇。）",
            "上九：同人于郊，無悔。（白話：同人於郊，無悔。）"
        ]},
        {"id": 14, "name": "大有", "pinyin": "Da You", "symbol": "離上乾下", "trigram_upper": 5, "trigram_lower": 7, "short": "火天大有", "ci": "元亨。", "ci_white": "元始亨通。", "yao_white": [
            "初九：無交害，匪咎，艱則無咎。（白話：無交害，匪咎，艱則無咎。）",
            "九二：大車以載，有攸往，無咎。（白話：大車以載，有攸往，無咎。）",
            "九三：公用亨于天子，小人弗克。（白話：公用亨于天子，小人弗克。）",
            "九四：匪其彭，無咎。（白話：匪其彭，無咎。）",
            "六五：厥孚交如，威如，吉。（白話：厥孚交如，威如，吉。）",
            "上九：自天祐之，吉無不利。（白話：自天祐之，吉無不利。）"
        ]},
        {"id": 15, "name": "謙", "pinyin": "Qian", "symbol": "坤上艮下", "trigram_upper": 0, "trigram_lower": 4, "short": "地山謙", "ci": "亨，君子有終。", "ci_white": "亨通，君子有善終。", "yao_white": [
            "初六：謙謙君子，卑以自牧也，吉。（白話：謙謙君子，卑以自牧也，吉。）",
            "六二：鳴謙，貞吉。鳴如響之，志意定也。（白話：鳴謙，正固吉。鳴如響之，志意定也。）",
            "九三：勞謙君子，有終吉。（白話：勞謙君子，有終吉。）",
            "六四：無不利，撝謙也。（白話：無不利，撝謙也。）",
            "六五：不富以其鄰，利用侵伐，無不利。（白話：不富以其鄰，利用侵伐，無不利。）",
            "上六：鳴謙，利用行師，征邑國。（白話：鳴謙，利用行師，征邑國。）"
        ]},
        {"id": 16, "name": "豫", "pinyin": "Yu", "symbol": "震上坤下", "trigram_upper": 1, "trigram_lower": 0, "short": "雷地豫", "ci": "利建侯行師。", "ci_white": "有利建立諸侯，出師作戰。", "yao_white": [
            "初六：鳴豫，凶。（白話：鳴豫，凶。）",
            "六二：介于石，不終日，貞吉。（白話：介於石，不終日，正固吉。）",
            "六三：盱豫有悔，介疾有喜。（白話：盱豫有悔，介疾有喜。）",
            "九四：由豫，大有得，勿疑，朋盍簪。（白話：由豫，大有得，勿疑，朋盍簪。）",
            "六五：貞疾，恒不死。（白話：正固疾，恒不死。）",
            "上六：冥豫成有渝，無咎。（白話：冥豫成有渝，無咎。）"
        ]},
        {"id": 17, "name": "隨", "pinyin": "Sui", "symbol": "兌上震下", "trigram_upper": 3, "trigram_lower": 1, "short": "澤雷隨", "ci": "元亨利貞,无咎。", "ci_white": "元始亨通有利正固，無咎。", "yao_white": [
            "初九：官有渝，貞吉。出门交有功。（白話：官有渝，正固吉。出门交有功。）",
            "六二：系小子，失丈夫。（白話：系小子，失丈夫。）",
            "六三：系丈夫，失小子。隨有求得，利居貞。（白話：系丈夫，失小子。隨有求得，利居正固。）",
            "九四：隨有獲，貞凶。有孚在道，以明，何咎。（白話：隨有獲，正固凶。有孚在道，以明，何咎。）",
            "九五：孚于嘉，吉。（白話：孚於嘉，吉。）",
            "上六：拘系之，乃從維之，王用亨于西山。（白話：拘系之，乃從維之，王用亨於西山。）"
        ]},
        {"id": 18, "name": "蠱", "pinyin": "Gu", "symbol": "巽上艮下", "trigram_upper": 6, "trigram_lower": 4, "short": "山風蠱", "ci": "元亨，利涉大川。先甲三日，後甲三日。", "ci_white": "元始亨通，有利渡大河。先甲三日，後甲三日。", "yao_white": [
            "初六：幹父之蠱，有子，考無咎，厲終吉。（白話：幹父之蠱，有子，考無咎，厲終吉。）",
            "九二：幹母之蠱，不可貞。（白話：幹母之蠱，不可正固。）",
            "九三：幹父之蠱，小有悔，無大咎。（白話：幹父之蠱，小有悔，無大咎。）",
            "六四：裕父之蠱，往見吝。（白話：裕父之蠱，往見吝。）",
            "六五：幹父之蠱，用譽。（白話：幹父之蠱，用譽。）",
            "上九：不事王侯，高尚其事。（白話：不事王侯，高尚其事。）"
        ]},
        {"id": 19, "name": "臨", "pinyin": "Lin", "symbol": "坤上兌下", "trigram_upper": 0, "trigram_lower": 3, "short": "地澤臨", "ci": "元亨利貞。至於八月有凶。", "ci_white": "元始亨通有利正固。到八月有凶。", "yao_white": [
            "初九：咸臨，貞吉。（白話：咸臨，正固吉。）",
            "九二：咸臨，吉，無不利。（白話：咸臨，吉，無不利。）",
            "六三：甘臨，無攸利。既憂之，無咎。（白話：甘臨，無所利。既憂之，無咎。）",
            "六四：至臨，無咎。（白話：至臨，無咎。）",
            "六五：知臨，大君之宜，吉。（白話：知臨，大君之宜，吉。）",
            "上六：敦臨，吉，無咎。（白話：敦臨，吉，無咎。）"
        ]},
        {"id": 20, "name": "觀", "pinyin": "Guan", "symbol": "巽上坤下", "trigram_upper": 6, "trigram_lower": 0, "short": "風地觀", "ci": "盥而不薦，有孚顒若。", "ci_white": "洗手而不獻祭，有誠信而莊嚴。", "yao_white": [
            "初六：童觀，小人無咎，君子之吝。（白話：童觀，小人無咎，君子之吝。）",
            "六二：窺觀，利女貞。（白話：窺觀，利女正固。）",
            "六三：觀我生，君子無咎。（白話：觀我生，君子無咎。）",
            "六四：觀國之光，利用賓于王。（白話：觀國之光，利用賓於王。）",
            "九五：觀國之光，利用出臧。（白話：觀國之光，利用出臧。）",
            "上九：觀其生，君子無咎。（白話：觀其生，君子無咎。）"
        ]},
        {"id": 21, "name": "噬嗑", "pinyin": "Shi He", "symbol": "離上震下", "trigram_upper": 5, "trigram_lower": 1, "short": "火雷噬嗑", "ci": "亨。利用獄。", "ci_white": "亨通。有利於審判。", "yao_white": [
            "初九：屨校滅趾，無咎。（白話：屨校滅趾，無咎。）",
            "六二：噬膚滅鼻，無咎。（白話：噬膚滅鼻，無咎。）",
            "六三：噬腊肉，遇毒，小吝，無咎。（白話：噬腊肉，遇毒，小吝，無咎。）",
            "九四：噬乾胏，得金矢，利艱貞，吉。（白話：噬乾胏，得金矢，利艱正固，吉。）",
            "六五：噬乾肉，得黃金，貞厲，無咎。（白話：噬乾肉，得黃金，正固危險，無咎。）",
            "上九：何校滅耳，凶。（白話：何校滅耳，凶。）"
        ]},
        {"id": 22, "name": "賁", "pinyin": "Bi", "symbol": "艮上離下", "trigram_upper": 4, "trigram_lower": 5, "short": "山火賁", "ci": "亨。小利有攸往。", "ci_white": "亨通。小有利於有所往。", "yao_white": [
            "初六：賁其趾，舍車而徒。（白話：賁其趾，舍車而徒。）",
            "六二：賁其須。（白話：賁其須。）",
            "九三：賁如濡如，永貞吉。（白話：賁如濡如，永正固吉。）",
            "六四：賁如皤如，白馬翰如，匪寇婚媾。（白話：賁如皤如，白馬翰如，匪寇婚媾。）",
            "六五：賁于丘園，束帛戔戔，吝，終吉。（白話：賁於丘園，束帛戔戔，吝，終吉。）",
            "上九：白賁，無咎。（白話：白賁，無咎。）"
        ]},
        {"id": 23, "name": "剝", "pinyin": "Bo", "symbol": "艮上坤下", "trigram_upper": 4, "trigram_lower": 0, "short": "山地剝", "ci": "利西南，不利有攸往。", "ci_white": "利西南，不利有所往。", "yao_white": [
            "初六：剝床以足，蔑貞凶。（白話：剝床以足，蔑正固凶。）",
            "六二：剝床以辨，蔑貞凶。（白話：剝床以辨，蔑正固凶。）",
            "六三：剝之，無咎。（白話：剝之，無咎。）",
            "六四：剝床以膚，凶。（白話：剝床以膚，凶。）",
            "六五：貫魚，以宮人寵，無不利。（白話：貫魚，以宮人寵，無不利。）",
            "上九：碩果不食，君子得輿，小人剝廬。（白話：碩果不食，君子得輿，小人剝廬。）"
        ]},
        {"id": 24, "name": "復", "pinyin": "Fu", "symbol": "坤上震下", "trigram_upper": 0, "trigram_lower": 1, "short": "地雷復", "ci": "亨。出入无疾，朋來无咎。反復其道，七日來復，利有攸往。", "ci_white": "亨通。出入無病，朋友來無咎。反覆其道，七日來復，有利有所往。", "yao_white": [
            "初九：不遠復，無祇悔，元吉。（白話：不遠復，無祇悔，元吉。）",
            "六二：休復，吉。（白話：休復，吉。）",
            "六三：頻復，厲無咎。（白話：頻復，厲無咎。）",
            "六四：中行獨復。（白話：中行獨復。）",
            "六五：敦復，無悔。（白話：敦復，無悔。）",
            "上六：迷復，凶，有災眚。用行師，終有大敗，以其國君凶；至于十年不克征。（白話：迷復，凶，有災眚。用行師，終有大敗，以其國君凶；至于十年不克征。）"
        ]},
        {"id": 25, "name": "無妄", "pinyin": "Wu Wang", "symbol": "乾上震下", "trigram_upper": 7, "trigram_lower": 1, "short": "天雷無妄", "ci": "元亨利貞。其匪正有眚，不利有攸往。", "ci_white": "元始亨通有利正固。不正則有災，不利有所往。", "yao_white": [
            "初九：無妄，往吉。（白話：無妄，前進吉。）",
            "六二：不耕獲，不菑畝，不菑，則所得有孚元吉。（白話：不耕獲，不菑畝，不菑，則所得有孚元吉。）",
            "六三：無妄之災，或繩之牛，行人之得，邑人之災。（白話：無妄之災，或繩之牛，行人之得，邑人之災。）",
            "九四：可貞，無咎。（白話：可正固，無咎。）",
            "九五：無妄之疾，勿藥有喜。（白話：無妄之疾，勿藥有喜。）",
            "上九：無妄，行有眚，無攸利。（白話：無妄，行有眚，無所利。）"
        ]},
        {"id": 26, "name": "大畜", "pinyin": "Da Chu", "symbol": "艮上乾下", "trigram_upper": 4, "trigram_lower": 7, "short": "山天大畜", "ci": "利貞。不家食吉，利涉大川。", "ci_white": "有利正固。不在家食吉，有利渡大河。", "yao_white": [
            "初九：有厲利已。（白話：有厲利已。）",
            "九二：輿說輻。（白話：輿說輻。）",
            "九三：良馬逐，利貞。曰閑。（白話：良馬逐，利正固。曰閑。）",
            "六四：童牛之牿，元吉。（白話：童牛之牿，元吉。）",
            "六五：豕之牙吉。（白話：豕之牙吉。）",
            "上九：何天之衢，亨。（白話：何天之衢，亨。）"
        ]},
        {"id": 27, "name": "頤", "pinyin": "Yi", "symbol": "震上艮下", "trigram_upper": 1, "trigram_lower": 4, "short": "雷山頤", "ci": "貞吉。觀頤，自求口實。", "ci_white": "正固吉。觀其養生之道，自求口食。", "yao_white": [
            "初九：舍爾靈龜，觀我朵頤，凶。（白話：舍爾靈龜，觀我朵頤，凶。）",
            "六二：顛頤，拂經于丘頤，征凶。（白話：顛頤，拂經於丘頤，征凶。）",
            "六三：拂頤，貞凶。十年勿用，無攸利。（白話：拂頤，正固凶。十年勿用，無所利。）",
            "六四：顛頤，吉。虎視眈眈，其欲逐逐，無咎。（白話：顛頤，吉。虎視眈眈，其欲逐逐，無咎。）",
            "六五：拂經，居貞吉，不可涉大川。（白話：拂經，居正固吉，不可涉大川。）",
            "上九：由頤，厲吉，利涉大川。（白話：由頤，厲吉，利涉大川。）"
        ]},
        {"id": 28, "name": "大過", "pinyin": "Da Guo", "symbol": "兌上巽下", "trigram_upper": 3, "trigram_lower": 6, "short": "澤風大過", "ci": "棟橈，利有攸往，亨。", "ci_white": "棟梁彎曲，有利有所往，亨通。", "yao_white": [
            "初六：藉用白茅，無咎。（白話：藉用白茅，無咎。）",
            "九二：枯楊生稊，老夫得其女妻，無不利。（白話：枯楊生稊，老夫得其女妻，無不利。）",
            "九三：棟撓，厲。（白話：棟撓，厲。）",
            "九四：棟隆，吉，有它吝。（白話：棟隆，吉，有它吝。）",
            "九五：枯楊生華，老婦得其士夫，無咎無譽。（白話：枯楊生華，老婦得其士夫，無咎無譽。）",
            "上六：過涉滅頂，凶，無咎。（白話：過涉滅頂，凶，無咎。）"
        ]},
        {"id": 29, "name": "坎", "pinyin": "Kan", "symbol": "坎上坎下", "trigram_upper": 2, "trigram_lower": 2, "short": "坎為水", "ci": "習坎。有孚，維心亨，行有尚。", "ci_white": "習於險中。有誠信，心亨通，行有功。", "yao_white": [
            "初六：習坎，入于坎窞，凶。（白話：習坎，入於坎窞，凶。）",
            "六二：坎有險，求小得。（白話：坎有險，求小得。）",
            "九三：來之坎坎，險且枕，入于坎窞，勿用。（白話：來之坎坎，險且枕，入於坎窞，勿用。）",
            "六四：樽酒簋贰，用缶，納約自牖，終無咎。（白話：樽酒簋二，用缶，納約自牖，終無咎。）",
            "九五：坎不盈，祗既平，無咎。（白話：坎不盈，祗既平，無咎。）",
            "上六：繫用徽纆，置于叢棘，三歲不得，凶。（白話：繫用徽纆，置於叢棘，三歲不得，凶。）"
        ]},
        {"id": 30, "name": "離", "pinyin": "Li", "symbol": "離上離下", "trigram_upper": 5, "trigram_lower": 5, "short": "離為火", "ci": "利貞，亨。畜牝牛吉。", "ci_white": "有利正固，亨通。養牝牛吉。", "yao_white": [
            "初九：履錯然，敬之無咎。（白話：履錯然，敬之無咎。）",
            "六二：黃離，元吉。（白話：黃離，元吉。）",
            "九三：日昃之離，不鼓缶而歌，則大耋之嗟，凶。（白話：日昃之離，不鼓缶而歌，則大耋之嗟，凶。）",
            "九四：突如其來如，焚如，死如，棄如。（白話：突如其來如，焚如，死如，棄如。）",
            "六五：出涕沱若，戚嗟若，吉。（白話：出涕沱若，戚嗟若，吉。）",
            "上九：王用出征，有嘉折首，獲匪其丑，吉。（白話：王用出征，有嘉折首，獲匪其丑，吉。）"
        ]},
        {"id": 31, "name": "咸", "pinyin": "Xian", "symbol": "兌上艮下", "trigram_upper": 3, "trigram_lower": 4, "short": "澤山咸", "ci": "亨，利貞，取女吉。", "ci_white": "亨通，有利正固，取女吉。", "yao_white": [
            "初六：咸其拇。（白話：咸其拇。）",
            "六二：咸其腓，凶，居吉。（白話：咸其腓，凶，居吉。）",
            "九三：咸其股，執其隨，往吝。（白話：咸其股，執其隨，往吝。）",
            "九四：貞吉，悔亡。憧憧往來，朋從爾思。（白話：正固吉，悔亡。憧憧往來，朋從爾思。）",
            "九五：咸其脢，無悔。（白話：咸其脢，無悔。）",
            "上六：咸其輔，頰，舌。（白話：咸其輔，頰，舌。）"
        ]},
        {"id": 32, "name": "恒", "pinyin": "Heng", "symbol": "巽上震下", "trigram_upper": 6, "trigram_lower": 1, "short": "雷風恒", "ci": "亨,无咎，利貞，利有攸往。", "ci_white": "亨通，無咎，有利正固，有利有所往。", "yao_white": [
            "初六：浚恒，貞凶，無攸利。（白話：浚恒，正固凶，無所利。）",
            "九二：悔亡。（白話：悔亡。）",
            "九三：不恒其德，或承之羞，貞吝。（白話：不恒其德，或承之羞，正固吝。）",
            "六四：貞吉，悔亡。憧憧往來，朋從爾思。（白話：正固吉，悔亡。憧憧往來，朋從爾思。）",
            "九五：貞吉，無悔。君子之光，有孚吉。（白話：正固吉，無悔。君子之光，有孚吉。）",
            "上六：振恒，凶。（白話：振恒，凶。）"
        ]},
        {"id": 33, "name": "遯", "pinyin": "Dun", "symbol": "乾上艮下", "trigram_upper": 7, "trigram_lower": 4, "short": "天山遯", "ci": "亨。小利貞。", "ci_white": "亨通。小有利正固。", "yao_white": [
            "初六：遯尾，厲，勿用有攸往。（白話：遯尾，厲，勿用有攸往。）",
            "六二：執之用黃牛之革，莫之勝說。（白話：執之用黃牛之革，莫之勝說。）",
            "九三：系遯，有疾厲，貞有說。（白話：系遯，有疾厲，正固有說。）",
            "九四：好遯，君子吉，小人否。（白話：好遯，君子吉，小人否。）",
            "九五：嘉遯，貞吉。（白話：嘉遯，正固吉。）",
            "上九：肥遯，無不利。（白話：肥遯，無不利。）"
        ]},
        {"id": 34, "name": "大壯", "pinyin": "Da Zhuang", "symbol": "震上乾下", "trigram_upper": 1, "trigram_lower": 7, "short": "雷天大壯", "ci": "利貞。", "ci_white": "有利正固。", "yao_white": [
            "初九：壯于趾，征凶，有孚。（白話：壯於趾，征凶，有孚。）",
            "九二：貞吉。（白話：正固吉。）",
            "九三：小人用壯，君子用罔，貞厲。羝羊觸藩，羸其角。（白話：小人用壯，君子用罔，正固厲。羝羊觸藩，羸其角。）",
            "九四：貞吉悔亡，藩決不羸，壯于大輿之輹。（白話：正固吉悔亡，藩決不羸，壯於大輿之輹。）",
            "六五：喪羊于易，無悔。（白話：喪羊於易，無悔。）",
            "上六：羝羊觸藩，不能退，不能遂，無攸利，艱則吉。（白話：羝羊觸藩，不能退，不能遂，無所利，艱則吉。）"
        ]},
        {"id": 35, "name": "晉", "pinyin": "Jin", "symbol": "離上坤下", "trigram_upper": 5, "trigram_lower": 0, "short": "火地晉", "ci": "康侯用錫馬蕃庶，晝日三接。", "ci_white": "康侯用賞賜馬匹繁多，白天三度接見。", "yao_white": [
            "初六：晉如摧如，貞吉。罔孚，裕無咎。（白話：晉如摧如，正固吉。罔孚，裕無咎。）",
            "六二：晉如愁如，貞吉。受茲介福，于其王母。（白話：晉如愁如，正固吉。受茲介福，于其王母。）",
            "六三：眾允，悔亡。（白話：眾允，悔亡。）",
            "九四：晉如鼫鼠，貞厲。（白話：晉如鼫鼠，正固厲。）",
            "六五：悔亡，失得勿恤，往吉，無不利。（白話：悔亡，失得勿恤，往吉，無不利。）",
            "上九：晉其角，維用伐邑，厲吉無咎，貞吝。（白話：晉其角，維用伐邑，厲吉無咎，正固吝。）"
        ]},
        {"id": 36, "name": "明夷", "pinyin": "Ming Yi", "symbol": "坤上離下", "trigram_upper": 0, "trigram_lower": 5, "short": "地火明夷", "ci": "利艱貞。", "ci_white": "有利於艱難中正固。", "yao_white": [
            "初九：明夷于飛，垂其翼。君子于行，三日不食。有攸往，主人有言。（白話：明夷於飛，垂其翼。君子於行，三日不食。有攸往，主人有言。）",
            "六二：明夷，夷于左股，用拯馬壯，吉。（白話：明夷，夷於左股，用拯馬壯，吉。）",
            "九三：明夷于南狩，得其大首，不可疾貞。（白話：明夷於南狩，得其大首，不可疾正固。）",
            "六四：入于左腹，獲明夷之心，于出門庭。（白話：入於左腹，獲明夷之心，于出门庭。）",
            "六五：箕子之明夷，利貞。（白話：箕子之明夷，利正固。）",
            "上六：不明晦，初登于天，後入于地。（白話：不明晦，初登於天，後入於地。）"
        ]},
        {"id": 37, "name": "家人", "pinyin": "Jia Ren", "symbol": "巽上離下", "trigram_upper": 6, "trigram_lower": 5, "short": "風火家人", "ci": "利女貞。", "ci_white": "有利婦女正固。", "yao_white": [
            "初九：閑有家，悔亡。（白話：閑有家，悔亡。）",
            "六二：無攸遂，在中饋，貞吉。（白話：無攸遂，在中饋，正固吉。）",
            "九三：家人嗃嗃，悔厲吉；婦子嘻嘻，終吝。（白話：家人嗃嗃，悔厲吉；婦子嘻嘻，終吝。）",
            "六四：富家，大吉。（白話：富家，大吉。）",
            "九五：王假有家，勿恤，吉。（白話：王假有家，勿恤，吉。）",
            "上九：有孚威如，終吉。（白話：有孚威如，終吉。）"
        ]},
        {"id": 38, "name": "睽", "pinyin": "Kui", "symbol": "離上兌下", "trigram_upper": 5, "trigram_lower": 3, "short": "火澤睽", "ci": "小事吉。", "ci_white": "小事吉。", "yao_white": [
            "初六：悔亡，喪馬勿逐，自復，見惡人無咎。（白話：悔亡，喪馬勿逐，自復，見惡人無咎。）",
            "九二：遇主于巷，無咎。（白話：遇主於巷，無咎。）",
            "六三：見輿曳，其牛掣，其人天且劓，無初有終。（白話：見輿曳，其牛掣，其人天且劓，無初有終。）",
            "九四：睽孤，遇元夫，交孚，厲無咎。（白話：睽孤，遇元夫，交孚，厲無咎。）",
            "九五：悔亡，厥宗噬膚，往何咎。（白話：悔亡，厥宗噬膚，往何咎。）",
            "上九：睽孤見豕負塗，載鬼一車，先張之弧，後說之弧，匪寇婚媾，往遇雨則吉。（白話：睽孤見豕負塗，載鬼一車，先張之弧，後說之弧，匪寇婚媾，往遇雨則吉。）"
        ]},
        {"id": 39, "name": "蹇", "pinyin": "Jian", "symbol": "坎上艮下", "trigram_upper": 2, "trigram_lower": 4, "short": "水山蹇", "ci": "利西南，不利東北。利見大人，貞吉。", "ci_white": "利西南，不利東北。有利見大人，正固吉。", "yao_white": [
            "初六：往蹇來譽。（白話：往蹇來譽。）",
            "六二：王臣蹇蹇，終吉。（白話：王臣蹇蹇，終吉。）",
            "九三：往蹇來反。（白話：往蹇來反。）",
            "六四：往蹇來連。（白話：往蹇來連。）",
            "九五：大蹇朋來。（白話：大蹇朋來。）",
            "上六：往蹇來碩，吉，利見大人。（白話：往蹇來碩，吉，利見大人。）"
        ]},
        {"id": 40, "name": "解", "pinyin": "Xie", "symbol": "震上坎下", "trigram_upper": 1, "trigram_lower": 2, "short": "雷水解", "ci": "利西南，无所往，其來復吉。有攸往，夙吉。", "ci_white": "利西南，無所往，來歸復吉。有所往，早吉。", "yao_white": [
            "初六：無咎。（白話：無咎。）",
            "九二：田獲三狐，得黃矢，貞吉。（白話：田獲三狐，得黃矢，正固吉。）",
            "六三：負且乘，致寇至，貞吝。（白話：負且乘，致寇至，正固吝。）",
            "九四：解而拇，朋至斯孚。（白話：解而拇，朋至斯孚。）",
            "六五：君子維有解，吉，有孚于小人。（白話：君子維有解，吉，有孚於小人。）",
            "上六：公用射隼于高墉之上，獲之，無不利。（白話：公用射隼於高墉之上，獲之，無不利。）"
        ]},
        {"id": 41, "name": "損", "pinyin": "Sun", "symbol": "艮上兌下", "trigram_upper": 4, "trigram_lower": 3, "short": "山澤損", "ci": "有孚，元吉,无咎，可貞，利有攸往。曷之用，二簋可用享。", "ci_white": "有誠信，元吉，無咎，可正固，有利有所往。何用之？二簋可用享祭。", "yao_white": [
            "初九：已事遄往，無咎，酌損之。（白話：已事遄往，無咎，酌損之。）",
            "九二：利貞，徵凶，弗損益之。（白話：利正固，徵凶，弗損益之。）",
            "六三：三人行，則損一人；一人行，則得其友。（白話：三人行，則損一人；一人行，則得其友。）",
            "六四：損其疾，使遄有喜，無咎。（白話：損其疾，使遄有喜，無咎。）",
            "六五：或躍在淵，乾道乃革。（白話：或躍在淵，乾道乃革。）",
            "上九：弗損益之，無咎，貞吉，利有攸往，得臣無家。（白話：弗損益之，無咎，正固吉，利有攸往，得臣無家。）"
        ]},
        {"id": 42, "name": "益", "pinyin": "Yi", "symbol": "巽上震下", "trigram_upper": 6, "trigram_lower": 1, "short": "風雷益", "ci": "利有攸往，利涉大川。", "ci_white": "有利有所往，有利渡大河。", "yao_white": [
            "初九：利用為大作，元吉，無咎。（白話：利用為大作，元吉，無咎。）",
            "六二：或躍在淵，乾道乃革。（白話：或躍在淵，乾道乃革。）",
            "六三：益之用凶事，無咎。有孚中行，告公用圭。（白話：益之用凶事，無咎。有孚中行，告公用圭。）",
            "六四：中行，告公從，利用為依遷國。（白話：中行，告公從，利用為依遷國。）",
            "九五：有孚惠心，勿問元吉，有孚惠我德。（白話：有孚惠心，勿問元吉，有孚惠我德。）",
            "上九：莫益之，或擊之，百獸率舞。（白話：莫益之，或擊之，百獸率舞。）"
        ]},
        {"id": 43, "name": "夬", "pinyin": "Guai", "symbol": "兌上乾下", "trigram_upper": 3, "trigram_lower": 7, "short": "澤天夬", "ci": "揚于王庭，孚號有厲，告自邑，不利即戎，利有攸往。", "ci_white": "揚於王庭，有誠信呼號有危，告知邑中，不利即用兵，有利有所往。", "yao_white": [
            "初九：壯于前趾，往不勝為咎。（白話：壯於前趾，往不勝為咎。）",
            "九二：惕號，莫夜有戎，勿恤。（白話：惕號，莫夜有戎，勿恤。）",
            "九三：壯于頄，有凶。君子夬夬獨行，遇雨若濡，有愠無咎。（白話：壯於頄，有凶。君子夬夬獨行，遇雨若濡，有愠無咎。）",
            "九四：臀無膚，其行次且，牽羊悔亡，聞言不信。（白話：臀無膚，其行次且，牽羊悔亡，聞言不信。）",
            "九五：莧陸夬夬，中行無咎。（白話：莧陸夬夬，中行無咎。）",
            "上六：無號，終有凶。（白話：無號，終有凶。）"
        ]},
        {"id": 44, "name": "姤", "pinyin": "Gou", "symbol": "巽上乾下", "trigram_upper": 6, "trigram_lower": 7, "short": "天風姤", "ci": "女壯，勿用取女。", "ci_white": "女子強壯，不要娶這樣的女子。", "yao_white": [
            "初六：系于金柅，貞吉。有攸往、見凶，羸豕孚蹢。（白話：系於金柅，正固吉。有攸往，見凶，羸豕孚蹢。）",
            "九二：包有魚，無咎，不利賓。（白話：包有魚，無咎，不利賓。）",
            "九三：臀無膚，其行次且，引羊撄其角，凶。（白話：臀無膚，其行次且，引羊撄其角，凶。）",
            "九四：包無魚，起凶。（白話：包無魚，起凶。）",
            "九五：以杞包瓜，含章，有隕自天。（白話：以杞包瓜，含章，有隕自天。）",
            "上九：姤其角，吝，無咎。（白話：姤其角，吝，無咎。）"
        ]},
        {"id": 45, "name": "萃", "pinyin": "Cui", "symbol": "兌上坤下", "trigram_upper": 3, "trigram_lower": 0, "short": "澤地萃", "ci": "亨。王假有廟，利見大人，亨，利貞。用大牲吉，利有攸往。", "ci_white": "亨通。王假廟祀，有利見大人，亨通，有利正固。用大牲吉，有利有所往。", "yao_white": [
            "初六：有孚不終，乃亂乃萃，若號，一握為笑，勿恤，往無咎。（白話：有孚不終，乃亂乃萃，若號，一握為笑，勿恤，往無咎。）",
            "六二：引吉，無咎，孚乃利用禴。（白話：引吉，無咎，孚乃利用禴。）",
            "六三：萃如嗟如，無攸利，往無咎，小吝。（白話：萃如嗟如，無所利，往無咎，小吝。）",
            "九四：大吉，無咎。（白話：大吉，無咎。）",
            "九五：萃有位，無咎，匪孚元永貞，悔亡。（白話：萃有位，無咎，匪孚元永正固，悔亡。）",
            "上六：齎咨涕洟，無咎。（白話：齎咨涕洟，無咎。）"
        ]},
        {"id": 46, "name": "升", "pinyin": "Sheng", "symbol": "坤上巽下", "trigram_upper": 0, "trigram_lower": 6, "short": "地風升", "ci": "元亨，用見大人，勿恤，南征吉。", "ci_white": "元始亨通，用見大人，勿憂，南征吉。", "yao_white": [
            "初六：允升，大吉。（白話：允升，大吉。）",
            "九二：孚乃利用禴，無咎。（白話：孚乃利用禴，無咎。）",
            "九三：升虛邑，無所疑。（白話：升虛邑，無所疑。）",
            "六四：王用亨于岐山，吉，無咎。（白話：王用亨於岐山，吉，無咎。）",
            "九五：貞吉升階。（白話：正固吉升階。）",
            "上六：冥升，利于不息之貞。（白話：冥升，利於不息之正固。）"
        ]},
        {"id": 47, "name": "困", "pinyin": "Kun", "symbol": "兌上坎下", "trigram_upper": 3, "trigram_lower": 2, "short": "澤水困", "ci": "亨，貞，大人吉，无咎。有言不信。", "ci_white": "亨通，正固，大人吉，無咎。有言不信。", "yao_white": [
            "初六：臀困于株木，入于幽谷，三歲不覿。（白話：臀困於株木，入於幽谷，三歲不覿。）",
            "九二：困于酒食，朱紱方來，利用享祀，征凶，無咎。（白話：困於酒食，朱紱方來，利用享祀，征凶，無咎。）",
            "六三：困于石，據于蒺藜，入于其宮，不見其妻，凶。（白話：困於石，據於蒺藜，入於其宮，不見其妻，凶。）",
            "九四：來徐徐，困于金車，吝，有終。（白話：來徐徐，困於金車，吝，有終。）",
            "九五：劓刖，困于赤紱，乃徐有說，利用祭祀。（白話：劓刖，困於赤紱，乃徐有說，利用祭祀。）",
            "上六：困于葛藟，于臲卼，曰動悔，有悔，征吉。（白話：困於葛藟，于臲卼，曰動悔，有悔，征吉。）"
        ]},
        {"id": 48, "name": "井", "pinyin": "Jing", "symbol": "坎上巽下", "trigram_upper": 2, "trigram_lower": 6, "short": "水風井", "ci": "改邑不改井,无喪无得，往來井井。汔至亦未繘井，羸其瓶，凶。", "ci_white": "改邑不改井，無喪無得，往來井井。將至卻未繘井，瓶子漏了，凶。", "yao_white": [
            "初六：井泥不食，舊井無禽。（白話：井泥不食，舊井無禽。）",
            "九二：井谷射鮒，瓮敝漏。（白話：井谷射鮒，瓮敝漏。）",
            "九三：井渫不食，為我心恻，可用汲，王明，並受其福。（白話：井渫不食，為我心恻，可用汲，王明，並受其福。）",
            "六四：井甃，無咎。（白話：井甃，無咎。）",
            "九五：井洌冷泉食。（白話：井洌冷泉食。）",
            "上六：井收勿幕，有孚元吉。（白話：井收勿幕，有孚元吉。）"
        ]},
        {"id": 49, "name": "革", "pinyin": "Ge", "symbol": "兌上離下", "trigram_upper": 3, "trigram_lower": 5, "short": "澤火革", "ci": "己日乃孚，元亨利貞，悔亡。", "ci_white": "己日乃孚，元始亨通有利正固，悔亡。", "yao_white": [
            "初六：鞏用黃牛之革。（白話：鞏用黃牛之革。）",
            "六二：己日乃革之，征吉，無咎。（白話：己日乃革之，征吉，無咎。）",
            "九三：征凶，貞厲。已革面，改命君子，吉。（白話：征凶，正固厲。已革面，改命君子，吉。）",
            "九四：悔亡，有孚改命，吉。（白話：悔亡，有孚改命，吉。）",
            "九五：大人虎變，未占有孚。（白話：大人虎變，未占有孚。）",
            "上六：君子豹變，小人革面，征凶，居貞吉。（白話：君子豹變，小人革面，征凶，居正固吉。）"
        ]},
        {"id": 50, "name": "鼎", "pinyin": "Ding", "symbol": "離上巽下", "trigram_upper": 5, "trigram_lower": 6, "short": "火風鼎", "ci": "元吉，亨。", "ci_white": "元吉，亨通。", "yao_white": [
            "初六：鼎顛趾，利出否，得妾以其子，無咎。（白話：鼎顛趾，利出否，得妾以其子，無咎。）",
            "九二：鼎有實，我仇有疾，不我能即，吉。（白話：鼎有實，我仇有疾，不我能即，吉。）",
            "九三：鼎耳革，其進無咎，利貞。（白話：鼎耳革，其進無咎，利正固。）",
            "九四：鼎折足，覆公餗，其形渥，凶。（白話：鼎折足，覆公餗，其形渥，凶。）",
            "六五：鼎黃耳金鉉，利貞。（白話：鼎黃耳金鉉，利正固。）",
            "上九：鼎玉鉉，大吉，無不利。（白話：鼎玉鉉，大吉，無不利。）"
        ]},
        {"id": 51, "name": "震", "pinyin": "Zhen", "symbol": "震上震下", "trigram_upper": 1, "trigram_lower": 1, "short": "震為雷", "ci": "亨。震來虩虩，笑言啞啞。震驚百里，不喪匕鬯。", "ci_white": "亨通。震來驚恐，笑言啞啞。震驚百里，不喪祭器。", "yao_white": [
            "初九：震來虩虩，後笑言啞啞，吉。（白話：震來虩虩，後笑言啞啞，吉。）",
            "六二：震來厲，億喪貝，躋于九陵，勿逐，七日得。（白話：震來厲，億喪貝，躋於九陵，勿逐，七日得。）",
            "六三：震蘇蘇，震行無眚。（白話：震蘇蘇，震行無眚。）",
            "九四：震蘇蘇，隕豕興惡，往，君子厲。（白話：震蘇蘇，隕豕興惡，往，君子厲。）",
            "六五：震往來厲，億無喪，有事。（白話：震往來厲，億無喪，有事。）",
            "上六：震索索，視矍矍，征凶。震不于其躬，于其鄰，無咎。婚媾有言。（白話：震索索，視矍矍，征凶。震不於其躬，于其鄰，無咎。婚媾有言。）"
        ]},
        {"id": 52, "name": "艮", "pinyin": "Gen", "symbol": "艮上艮下", "trigram_upper": 4, "trigram_lower": 4, "short": "艮為山", "ci": "艮其背，不獲其身，行其庭，不見其人，无咎。", "ci_white": "止其背，不獲其身，行其庭，不見其人，無咎。", "yao_white": [
            "初六：艮其趾，無咎，利永貞。（白話：艮其趾，無咎，利永正固。）",
            "六二：艮其腓，不拯其隨，其心不快。（白話：艮其腓，不拯其隨，其心不快。）",
            "九三：艮其限，列其夤，厲薰心。（白話：艮其限，列其夤，厲薰心。）",
            "六四：艮其身，無咎。（白話：艮其身，無咎。）",
            "六五：艮其輔，言有序，悔亡。（白話：艮其輔，言有序，悔亡。）",
            "上九：敦艮，吉。（白話：敦艮，吉。）"
        ]},
        {"id": 53, "name": "漸", "pinyin": "Jian", "symbol": "巽上艮下", "trigram_upper": 6, "trigram_lower": 4, "short": "風山漸", "ci": "女歸吉，利貞。", "ci_white": "女子歸嫁吉，有利正固。", "yao_white": [
            "初六：鴻漸于干，小子厲有言。（白話：鴻漸於干，小子厲有言。）",
            "六二：鴻漸于磐，飲食衎衎，吉。（白話：鴻漸於磐，飲食衎衎，吉。）",
            "九三：鴻漸于陸，夫征不復，婦孕不育，凶。利禦寇。（白話：鴻漸於陸，夫征不復，婦孕不育，凶。利禦寇。）",
            "六四：鴻漸于木，或得其桷，無咎。（白話：鴻漸於木，或得其桷，無咎。）",
            "九五：鴻漸于陵，婦三歲不孕，終莫之勝說，吉。（白話：鴻漸於陵，婦三歲不孕，終莫之勝說，吉。）",
            "上九：鴻漸于陸，其羽可用為儀，吉。（白話：鴻漸於陸，其羽可用為儀，吉。）"
        ]},
        {"id": 54, "name": "歸妹", "pinyin": "Gui Mei", "symbol": "兌上震下", "trigram_upper": 3, "trigram_lower": 1, "short": "雷澤歸妹", "ci": "征凶，无攸利。", "ci_white": "征伐凶，無所利。", "yao_white": [
            "初九：歸妹以娣，跛能履，貞凶。（白話：歸妹以娣，跛能履，正固凶。）",
            "九二：眇能視，利幽人之貞。（白話：眇能視，利幽人之正固。）",
            "六三：歸妹以須，反歸以娣。（白話：歸妹以須，反歸以娣。）",
            "九四：歸妹愆期，遲歸有時。（白話：歸妹愆期，遲歸有時。）",
            "六五：帝乙歸妹，其君之袂，不如其娣之袂良，月幾望，吉。（白話：帝乙歸妹，其君之袂，不如其娣之袂良，月幾望，吉。）",
            "上六：女承筐無實，士刲羊無血，無攸利。（白話：女承筐無實，士刲羊無血，無所利。）"
        ]},
        {"id": 55, "name": "豐", "pinyin": "Feng", "symbol": "離上震下", "trigram_upper": 5, "trigram_lower": 1, "short": "雷火豐", "ci": "亨，王假之，勿憂，宜日中。", "ci_white": "亨通，王用之，勿憂，宜於日中。", "yao_white": [
            "初九：遇其配主，雖旬無咎，往有尚。（白話：遇其配主，雖旬無咎，往有尚。）",
            "六二：豐其蔀，日中見斗，往得疑疾，有孚發若，吉。（白話：豐其蔀，日中見斗，往得疑疾，有孚發若，吉。）",
            "九三：豐其沛，日中見沫，折其右肱，無咎。（白話：豐其沛，日中見沫，折其右肱，無咎。）",
            "九四：豐其蔀，日中見斗，遇其夷主，吉。（白話：豐其蔀，日中見斗，遇其夷主，吉。）",
            "六五：來章，有慶譽，吉。（白話：來章，有慶譽，吉。）",
            "上六：豐其屋，蔀其家，窺其戶，闃其無人，三歲不覿，凶。（白話：豐其屋，蔀其家，窺其戶，闃其無人，三歲不覿，凶。）"
        ]},
        {"id": 56, "name": "旅", "pinyin": "Lü", "symbol": "艮上離下", "trigram_upper": 4, "trigram_lower": 5, "short": "火山旅", "ci": "小亨，旅貞吉。", "ci_white": "小亨通，旅人正固吉。", "yao_white": [
            "初六：旅瑣瑣，斯其所取災。（白話：旅瑣瑣，斯其所取災。）",
            "六二：旅即次，懷其資，得童僕貞。（白話：旅即次，懷其資，得童僕正固。）",
            "九三：旅焚其次，喪其童僕，貞厲。（白話：旅焚其次，喪其童僕，正固厲。）",
            "九四：旅于處，得其資斧，我心不快。（白話：旅於處，得其資斧，我心不快。）",
            "六五：射隼于高墉之上，獲之，無不利。（白話：射隼於高墉之上，獲之，無不利。）",
            "上九：鳥焚其巢，旅人先笑後號咷，喪牛于易，凶。（白話：鳥焚其巢，旅人先笑後號咷，喪牛於易，凶。）"
        ]},
        {"id": 57, "name": "巽", "pinyin": "Xun", "symbol": "巽上巽下", "trigram_upper": 6, "trigram_lower": 6, "short": "巽為風", "ci": "小亨，利有攸往，利見大人。", "ci_white": "小亨通，有利有所往，有利見大人。", "yao_white": [
            "初六：進退，利武人之貞。（白話：進退，利武人之正固。）",
            "九二：巽在床下，用史巫紛若，吉，無咎。（白話：巽在床下，用史巫紛若，吉，無咎。）",
            "九三：頻巽，吝。（白話：頻巽，吝。）",
            "六四：悔亡，田獲三品。（白話：悔亡，田獲三品。）",
            "九五：貞吉悔亡，無不利，無初有終。先庚三日，後庚三日，吉。（白話：正固吉悔亡，無不利，無初有終。先庚三日，後庚三日，吉。）",
            "上九：巽在床下，喪其資斧，貞凶。（白話：巽在床下，喪其資斧，正固凶。）"
        ]},
        {"id": 58, "name": "兌", "pinyin": "Dui", "symbol": "兌上兌下", "trigram_upper": 3, "trigram_lower": 3, "short": "兌為澤", "ci": "亨，利貞。", "ci_white": "亨通，有利正固。", "yao_white": [
            "初九：和兌，吉。（白話：和兌，吉。）",
            "九二：孚兌，吉，悔亡。（白話：孚兌，吉，悔亡。）",
            "六三：來兌，凶。（白話：來兌，凶。）",
            "九四：商兌，未寧，介疾有喜。（白話：商兌，未寧，介疾有喜。）",
            "九五：孚于剝，有厲。（白話：孚於剝，有厲。）",
            "上六：引兌。（白話：引兌。）"
        ]},
        {"id": 59, "name": "渙", "pinyin": "Huan", "symbol": "巽上坎下", "trigram_upper": 6, "trigram_lower": 2, "short": "風水渙", "ci": "亨。王假有廟，利涉大川，利貞。", "ci_white": "亨通。王假廟祀，有利渡大河，有利正固。", "yao_white": [
            "初六：用拯馬壯，吉。（白話：用拯馬壯，吉。）",
            "九二：渙奔其機，悔亡。（白話：渙奔其機，悔亡。）",
            "六三：渙其躬，無悔。（白話：渙其躬，無悔。）",
            "六四：渙其群，元吉。渙有丘，匪夷所思。（白話：渙其群，元吉。渙有丘，匪夷所思。）",
            "九五：渙汗其大號，渙王居，無咎。（白話：渙汗其大號，渙王居，無咎。）",
            "上九：渙其血，去逖出，無咎。（白話：渙其血，去逖出，無咎。）"
        ]},
        {"id": 60, "name": "節", "pinyin": "Jie", "symbol": "坎上兌下", "trigram_upper": 2, "trigram_lower": 3, "short": "水澤節", "ci": "亨。苦節不可貞。", "ci_white": "亨通。苦節不可正固。", "yao_white": [
            "初九：不出戶庭，無咎。（白話：不出戶庭，無咎。）",
            "九二：不出門庭，凶。（白話：不出門庭，凶。）",
            "六三：不節若，則嗟若，無咎。（白話：不節若，則嗟若，無咎。）",
            "六四：安節，亨。（白話：安節，亨。）",
            "九五：甘節，吉，往有尚。（白話：甘節，吉，往有尚。）",
            "上六：苦節，貞凶，悔亡。（白話：苦節，正固凶，悔亡。）"
        ]},
        {"id": 61, "name": "中孚", "pinyin": "Zhong Fu", "symbol": "巽上兌下", "trigram_upper": 6, "trigram_lower": 3, "short": "風澤中孚", "ci": "豚魚吉，利涉大川，利貞。", "ci_white": "豚魚吉，有利渡大河，有利正固。", "yao_white": [
            "初九：虞吉，有他不燕。（白話：虞吉，有他不燕。）",
            "九二：鳴鶴在陰，其子和之。我有好爵，吾與爾靡之。（白話：鳴鶴在陰，其子和之。我有好爵，吾與爾靡之。）",
            "六三：得敵，或鼓或罷，或泣或歌。（白話：得敵，或鼓或罷，或泣或歌。）",
            "六四：月幾望，馬匹亡，無咎。（白話：月幾望，馬匹亡，無咎。）",
            "九五：有孚攣如，無咎。（白話：有孚攣如，無咎。）",
            "上九：翰音登于天，貞凶。（白話：翰音登於天，正固凶。）"
        ]},
        {"id": 62, "name": "小過", "pinyin": "Xiao Guo", "symbol": "震上艮下", "trigram_upper": 1, "trigram_lower": 4, "short": "雷山小過", "ci": "亨，利貞，可小事，不可大事。飛鳥遺之音，不宜上，宜下，大吉。", "ci_white": "亨通，有利正固，可小事，不可大事。飛鳥遺音，不宜上，宜下，大吉。", "yao_white": [
            "初六：飛鳥遺音，其繫艱，貞凶。（白話：飛鳥遺音，其繫艱，正固凶。）",
            "六二：過其祖，遇其妣。行未輿死。（白話：過其祖，遇其妣。行未輿死。）",
            "九三：弗過防之，從或戕之，凶。（白話：弗過防之，從或戕之，凶。）",
            "九四：無咎，弗過遇之，往厲必戒，勿用永貞。（白話：無咎，弗過遇之，往厲必戒，勿用永正固。）",
            "六五：密雲不雨，自我西郊，公弋弗過，往，厲。（白話：密雲不雨，自我西郊，公弋弗過，往，厲。）",
            "上六：過涉滅頂，凶，無咎。（白話：過涉滅頂，凶，無咎。）"
        ]},
        {"id": 63, "name": "既濟", "pinyin": "Ji Ji", "symbol": "離上坎下", "trigram_upper": 5, "trigram_lower": 2, "short": "水火既濟", "ci": "亨小，利貞，初吉終亂。", "ci_white": "亨通小事，有利正固，初吉終亂。", "yao_white": [
            "初九：曳其輪，濡其尾，無咎。（白話：曳其輪，濡其尾，無咎。）",
            "六二：婦喪其茀，勿逐，七日得。（白話：婦喪其茀，勿逐，七日得。）",
            "九三：高宗伐鬼方，三年克之，小人勿用。（白話：高宗伐鬼方，三年克之，小人勿用。）",
            "六四：繻有衣袽，終日戒。（白話：繻有衣袽，終日戒。）",
            "九五：東鄰殺牛，不如西鄰之禴祭，實受其福。（白話：東鄰殺牛，不如西鄰之禴祭，實受其福。）",
            "上六：濡其首，厲。（白話：濡其首，厲。）"
        ]},
        {"id": 64, "name": "未濟", "pinyin": "Wei Ji", "symbol": "坎上離下", "trigram_upper": 2, "trigram_lower": 5, "short": "火水未濟", "ci": "亨，小狐汔濟，濡其尾,无攸利。", "ci_white": "亨通，小狐將濟濡其尾，無所利。", "yao_white": [
            "初六：濡其尾，吝。（白話：濡其尾，吝。）",
            "九二：曳其輪，貞吉。（白話：曳其輪，正固吉。）",
            "六三：未濟，征凶，利涉大川。（白話：未濟，征凶，利涉大川。）",
            "九四：貞吉悔亡，震用伐鬼方，三年有賞於大國。（白話：正固吉悔亡，震用伐鬼方，三年有賞於大國。）",
            "六五：貞吉無悔，君子之光，有孚吉。（白話：正固吉無悔，君子之光，有孚吉。）",
            "上九：有孚于飲酒無咎，濡其首，有孚失是。（白話：有孚於飲酒無咎，濡其首，有孚失是。）"
        ]}
    ],
    "array_8x8": [
        [2, 16, 8, 45, 23, 35, 20, 12],
        [24, 51, 3, 17, 27, 21, 42, 25],
        [7, 40, 29, 47, 4, 64, 59, 6],
        [19, 54, 60, 58, 41, 38, 61, 10],
        [15, 62, 39, 31, 52, 56, 53, 33],
        [36, 55, 63, 49, 22, 30, 37, 13],
        [46, 32, 48, 28, 18, 50, 57, 44],
        [11, 34, 5, 43, 26, 14, 9, 1]
    ]
};

// Create hexagram index
const hexagramById = {};
ichingData.hexagrams.forEach(hex => {
    hexagramById[hex.id] = hex;
});

// Create trigram index maps from embedded data
const trigramByBinary = {};
const trigramById = {};
const trigramByChar = {}

ichingData.trigrams.forEach(trigram => {
    trigramByBinary[trigram.binary] = trigram;
    trigramById[trigram.id] = trigram;
    trigramByChar[trigram.code] = trigram;
});

// Convert flip result to display string based on rules
function convertResult(flip) {
    const headsCount = flip.filter(coin => coin === 'H').length;
    const tailsCount = flip.filter(coin => coin === 'T').length;

    // Rule a: 2 tail 1 head -> ---
    if (tailsCount === 2 && headsCount === 1) {
        return '---';
    }
    // Rule b: 2 head 1 tail -> - -
    else if (headsCount === 2 && tailsCount === 1) {
        return '- -';
    }
    // Rule c: 3 head -> ---O
    else if (headsCount === 3) {
        return '---O';
    }
    // Rule d: 3 tail -> - -X
    else if (tailsCount === 3) {
        return '- -X';
    }
}

// Transform the converted result to final result based on rules
function transformResult(convertedResult) {
    // Rule 1: If the result is ---O, change it to - -
    if (convertedResult === '---O') {
        return '- -';
    }
    // Rule 2: If the result is - -X, change it to ---
    else if (convertedResult === '- -X') {
        return '---';
    }
    // Rule 3: Otherwise, keep the same
    else {
        return convertedResult;
    }
}

// Convert a single result to binary (0 or 1)
function resultToBinary(result) {
    // --- or ---O = 1
    if (result === '---' || result === '---O') {
        return '1';
    }
    // - - or - -X = 0
    else if (result === '- -' || result === '- -X') {
        return '0';
    }
    return '0'; // default
}

// Convert binary to symbol representation
function binaryToSymbol(binaryString) {
    // Convert each bit: 1 = '━━━' (solid line), 0 = '━ ━' (broken line)
    // Using Unicode box drawing characters for I Ching symbols
    let symbols = [];
    for (let i = 0; i < binaryString.length; i++) {
        symbols.push(binaryString[i] === '1' ? '━━━' : '━ ━');
    }
    return symbols;
}

// Calculate binary conversion for upper and lower groups
function calculateBinaryGroups(finalResults) {
    // Upper 3 results (indices 5, 4, 3) - from flip 6, 5, 4
    const upperGroup = [finalResults[5], finalResults[4], finalResults[3]];
    // Lower 3 results (indices 2, 1, 0) - from flip 3, 2, 1
    const lowerGroup = [finalResults[2], finalResults[1], finalResults[0]];

    const upperBinary = upperGroup.map(result => resultToBinary(result)).join('');
    const lowerBinary = lowerGroup.map(result => resultToBinary(result)).join('');

    return { upper: upperBinary, lower: lowerBinary };
}

// Look up result number from hex dictionary using combined binary
function lookupResultNumber(upperBinary, lowerBinary) {
    const combinedBinary = upperBinary + lowerBinary;
    return hexDict[combinedBinary] || 'N/A';
}

// Generate and display the hex dictionary lookup table
function generateHexTable(convertedBinary = null, finalBinary = null) {
    const tableElement = document.getElementById('hexTable');
    tableElement.innerHTML = ''; // Clear previous table
    

    

    
    // Header sequence in binary for columns
    const colHeaders = ['111', '011', '101', '001', '110', '010', '100', '000'];
    
    // Create thead
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th></th>'; // Corner cell
    
    colHeaders.forEach(binary => {
        const th = document.createElement('th');
        const trigram = trigramByBinary[binary];
        
        // Display trigram name
        const nameDiv = document.createElement('div');
        nameDiv.textContent = trigram.name;
        th.appendChild(nameDiv);
        
        // Display binary as vertical symbols
        const symbols = binaryToSymbol(binary);
        const symbolDiv = document.createElement('div');
        symbolDiv.className = 'header-symbol';
        symbolDiv.textContent = trigram.code;
        // symbols.forEach((symbol, index) => {
        //     if (index > 0) {
        //         symbolDiv.appendChild(document.createElement('br'));
        //     }
        //     symbolDiv.appendChild(document.createTextNode(symbol));
        // });
        th.appendChild(symbolDiv);
        
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    tableElement.appendChild(thead);
    
    // Create tbody
    const tbody = document.createElement('tbody');
    const rowHeaders = ['111', '011', '101', '001', '110', '010', '100', '000'];
    
    rowHeaders.forEach(rowBinary => {
        const row = document.createElement('tr');
        
        // Row header
        const rowHeaderCell = document.createElement('th');
        const rowTrigram = trigramByBinary[rowBinary];
        
        // Display trigram name
        const nameDiv = document.createElement('div');
        nameDiv.textContent = rowTrigram.name;
        rowHeaderCell.appendChild(nameDiv);
        
        // Display binary as vertical symbols
        const symbols = binaryToSymbol(rowBinary);
        const symbolDiv = document.createElement('div');
        symbolDiv.className = 'header-symbol';
        symbolDiv.textContent = rowTrigram.code;
        // symbols.forEach((symbol, index) => {
        //     if (index > 0) {
        //         symbolDiv.appendChild(document.createElement('br'));
        //     }
        //     symbolDiv.appendChild(document.createTextNode(symbol));
        // });
        rowHeaderCell.appendChild(symbolDiv);
        
        row.appendChild(rowHeaderCell);
        
        // Data cells
        colHeaders.forEach(colBinary => {
            const cell = document.createElement('td');
            const binaryValue = colBinary + rowBinary; // Column (Upper) + Row (Lower)
            const hexagramId = hexDict[binaryValue];
            const hexagram = hexagramById[hexagramId];
            
            cell.innerHTML = `
                <div class="hex-name">${hexagram.name}</div>
                <div class="hex-symbol">${hexagram.symbol}</div>
                <div class="hex-short">${hexagram.short}</div>
                <div class="hex-id">${hexagram.id}</div>                
            `;
            
            // Add click event to open modal
            cell.addEventListener('click', function() {
                openHexagramModal(hexagramId, hexagram.name);
            });
            
            // Add highlighting if this cell matches converted or final result
            if (convertedBinary && binaryValue === convertedBinary) {
                cell.classList.add('converted-result');
            }
            if (finalBinary && binaryValue === finalBinary) {
                cell.classList.add('final-result');
            }
            
            row.appendChild(cell);
        });
        
        tbody.appendChild(row);
    });
    tableElement.appendChild(tbody);
}

// Flip a single coin (returns 'H' for Heads or 'T' for Tails)
function flipCoin() {
    return Math.random() < 0.5 ? 'H' : 'T';
}

// Flip 3 coins once
function flipThreeCoins() {
    return [flipCoin(), flipCoin(), flipCoin()];
}

// Perform the simulation: flip 3 coins 6 times
function runSimulation() {
    const flips = [];
    for (let i = 0; i < 6; i++) {
        flips.push(flipThreeCoins());
    }
    return flips;
}

// Count heads and tails across all flips
function countResults(flips) {
    let headsCount = 0;
    let tailsCount = 0;

    flips.forEach(flip => {
        flip.forEach(coin => {
            if (coin === 'H') {
                headsCount++;
            } else {
                tailsCount++;
            }
        });
    });

    return { heads: headsCount, tails: tailsCount };
}

// Display the results on the page
function displayResults(flips) {
    const resultsSection = document.getElementById('results');
    const flipsContainer = document.getElementById('flipsContainer');
    const convertedContainer = document.getElementById('convertedContainer');
    const finalContainer = document.getElementById('finalContainer');
    
    // Clear previous results
    flipsContainer.innerHTML = '';
    convertedContainer.innerHTML = '';
    finalContainer.innerHTML = '';
    
    const convertedResults = []; // Store converted results
    const finalResults = []; // Store final results
    const changedResults = [];
    
    // Store reference for highlighting
    window.highlightedBinaries = { converted: null, final: null };
    
    // Display each flip result
    flips.forEach((flip, index) => {
        // Left column: Flip Results
        const flipDiv = document.createElement('div');
        flipDiv.className = 'flip-result';
        
        let flipHtml = `<h3>Flip ${index + 1}</h3>`;
        flip.forEach((coin) => {
            const coinClass = coin === 'H' ? 'heads' : 'tails';
            flipHtml += `<span class="coin ${coinClass}">${coin}</span>`;
        });
        
        flipDiv.innerHTML = flipHtml;
        flipsContainer.appendChild(flipDiv);

        // Middle column: Converted Results
        const convertedResult = convertResult(flip);
        convertedResults.push(convertedResult);
        if (convertedResult === '---O' || convertedResult === '- -X') {
            changedResults.push(index);
        }
        const convertedDiv = document.createElement('div');
        convertedDiv.className = 'converted-result';
        convertedDiv.textContent = convertedResult;
        convertedContainer.appendChild(convertedDiv);

        // Right column: Final Results
        const finalResult = transformResult(convertedResult);
        finalResults.push(finalResult);
        const finalDiv = document.createElement('div');
        finalDiv.className = 'final-result';
        finalDiv.textContent = finalResult;
        finalContainer.appendChild(finalDiv);
    });
    
    resultsSection.style.display = 'block';
    
    // Calculate and store binary values for highlighting
    const convertedBinaryGroups = calculateBinaryGroups(convertedResults);
    const finalBinaryGroups = calculateBinaryGroups(finalResults);
    window.highlightedBinaries.converted = convertedBinaryGroups.upper + convertedBinaryGroups.lower;
    window.highlightedBinaries.final = finalBinaryGroups.upper + finalBinaryGroups.lower;
    
    // Display binary conversion summary for both columns
    displayBinarySummary(convertedResults, finalResults);
    
    // Return the binary values for table highlighting
    return {
        convertedBinary: window.highlightedBinaries.converted,
        finalBinary: window.highlightedBinaries.final
    };
}

// Create or update the bar chart
function displayChart(counts) {
    const ctx = document.getElementById('statisticsChart').getContext('2d');
    
    if (statisticsChart) {
        statisticsChart.destroy();
    }
    
    statisticsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Heads', 'Tails'],
            datasets: [{
                label: 'Count',
                data: [counts.heads, counts.tails],
                backgroundColor: [
                    '#4CAF50',
                    '#FF9800'
                ],
                borderColor: [
                    '#45a049',
                    '#e68900'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'top'
                },
                title: {
                    display: true,
                    text: 'Coin Flip Results (3 coins × 6 flips = 18 total coins)'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 18,
                    ticks: {
                        stepSize: 2
                    }
                }
            }
        }
    });
    
    document.getElementById('chartSection').style.display = 'block';
}
// Open modal and display hexagram details
function openHexagramModal(hexagramId, hexagramName) {
    const hexagram = ichingData.hexagrams.find(h => h.id === hexagramId);
    if (!hexagram) return;

    reverseHexDict = Object.fromEntries(
        Object.entries(hexDict).map(([key, value]) => [value, key])
    );      
    
    document.getElementById('modalTitle').textContent = `${hexagram.name} (${hexagram.pinyin}) - #${hexagramId}`;

    modelSymbol = document.getElementById('modalSymbol');
    modelSymbol.innerHTML = '';
    reverseHexDict[hexagramId].split('').forEach((result, index) => {
        const lineDiv = document.createElement('div');
        lineDiv.className = 'line-symbol';
        lineoutput = result === '1' ? '\u2501'.repeat(3) : '\u2013 \u2013';
        lineResult = result === '1' ? '九' : '六';
        numnberToChinese = ["初","二","三","四","五","上"];
        
        if (index === 5 || index === 0)
        {
            lineoutput += `\t${numnberToChinese[5-index]}${lineResult}`;
        }
        else
        {
            lineoutput += `\t${lineResult}${numnberToChinese[5-index]}`;            
        }
        lineDiv.innerHTML = `<pre>${lineoutput}</pre>`;
        modelSymbol.appendChild(lineDiv);
    });    

    
    document.getElementById('modalBody').textContent = hexagram.ci;
    document.getElementById('modalBodyWhite').textContent = hexagram.ci_white;
    modalBodyExplain = document.getElementById('modalBodyExplain');
    modalBodyExplain.innerHTML = "";
    //document.getElementById('modalBodyExplain').innerHTML = hexagram.yao_white;
    [...hexagram.yao_white].reverse().forEach(line => {
        const p = document.createElement("p"); // create a <p> for each line
        p.textContent = line;
        modalBodyExplain.appendChild(p);
    });
    document.getElementById('hexagramModal').style.display = 'flex';

}


// Display binary conversion summary
function displayBinarySummary(convertedResults, finalResults) {
    const summarySection = document.getElementById('summarySection');
    const convertedUpperBinaryDiv = document.getElementById('convertedUpperBinary');
    const convertedUpperBinarySymbolDiv = document.getElementById('convertedUpperBinarySymbol');
    const convertedLowerBinaryDiv = document.getElementById('convertedLowerBinary');
    const convertedLowerBinarySymbolDiv = document.getElementById('convertedLowerBinarySymbol');
    const convertedCombinedDiv = document.getElementById('convertedCombined');
    const convertedResultNumberDiv = document.getElementById('convertedResultNumber');
    const convertedResultNameDiv = document.getElementById('convertedResultName');
    const convertedResultShortNameDiv = document.getElementById('convertedResultShortName');
    const convertedResultSymbolDiv = document.getElementById('convertedResultSymbol');
    const finalUpperBinaryDiv = document.getElementById('finalUpperBinary');
    const finalUpperBinarySymbolDiv = document.getElementById('finalUpperBinarySymbol');
    const finalLowerBinaryDiv = document.getElementById('finalLowerBinary');
    const finalLowerBinarySymbolDiv = document.getElementById('finalLowerBinarySymbol');
    const finalCombinedDiv = document.getElementById('finalCombined');
    const finalResultNumberDiv = document.getElementById('finalResultNumber');
    const finalResultNameDiv = document.getElementById('finalResultName');
    const finalResultShortNameDiv = document.getElementById('finalResultShortName');
    const finalResultSymbolDiv = document.getElementById('finalResultSymbol');
    
    const convertedBinaryGroups = calculateBinaryGroups(convertedResults);
    const finalBinaryGroups = calculateBinaryGroups(finalResults);
    

    // Display converted results
    trigram = trigramByBinary[convertedBinaryGroups.upper];    
    convertedUpperBinaryDiv.textContent = convertedBinaryGroups.upper;
    convertedUpperBinarySymbolDiv.textContent = trigram.code;

    trigram = trigramByBinary[convertedBinaryGroups.lower];        
    convertedLowerBinaryDiv.textContent = convertedBinaryGroups.lower;
    convertedLowerBinarySymbolDiv.textContent = trigram.code;

    const convertedCombined = convertedBinaryGroups.upper + convertedBinaryGroups.lower;
    convertedCombinedDiv.textContent = convertedCombined;
    const convertedResultNumber = lookupResultNumber(convertedBinaryGroups.upper, convertedBinaryGroups.lower);
    convertedResultNumberDiv.textContent = convertedResultNumber;
    convertedResultNameDiv.textContent = hexagramById[convertedResultNumber].symbol;
    convertedResultNameDiv.addEventListener('click', function() {
        openHexagramModal(convertedResultNumber, hexagramById[convertedResultNumber].name);
    });            
    convertedResultShortNameDiv.textContent = hexagramById[convertedResultNumber].short;
    convertedResultShortNameDiv.addEventListener('click', function() {
        openHexagramModal(convertedResultNumber, hexagramById[convertedResultNumber].name);
    });            
            
    convertedResultSymbolDiv.textContent = String.fromCodePoint(0x4DC0 + convertedResultNumber - 1);
    
    // Display final results
    trigram = trigramByBinary[finalBinaryGroups.upper];        
    finalUpperBinaryDiv.textContent = finalBinaryGroups.upper;
    finalUpperBinarySymbolDiv.textContent = trigram.code;

    trigram = trigramByBinary[finalBinaryGroups.lower];
    finalLowerBinaryDiv.textContent = finalBinaryGroups.lower;
    finalLowerBinarySymbolDiv.textContent = trigram.code;

    const finalCombined = finalBinaryGroups.upper + finalBinaryGroups.lower;
    finalCombinedDiv.textContent = finalCombined;
    const finalResultNumber = lookupResultNumber(finalBinaryGroups.upper, finalBinaryGroups.lower);
    finalResultNumberDiv.textContent = finalResultNumber;
    finalResultNameDiv.textContent = hexagramById[finalResultNumber].symbol;
    finalResultNameDiv.addEventListener('click', function() {
        openHexagramModal(finalResultNumber, hexagramById[finalResultNumber].name);
    });            
    finalResultShortNameDiv.textContent = hexagramById[finalResultNumber].short;
    finalResultShortNameDiv.addEventListener('click', function() {
        openHexagramModal(finalResultNumber, hexagramById[finalResultNumber].name);
    });    

    
    finalResultSymbolDiv.textContent = String.fromCodePoint(0x4DC0 + finalResultNumber - 1);
    
    summarySection.style.display = 'block';
}

// Main function to handle button click
function handleFlipButton() {
    const flips = runSimulation();
    const counts = countResults(flips);
    
    const { convertedBinary, finalBinary } = displayResults(flips);
    displayChart(counts);
    generateHexTable(convertedBinary, finalBinary);
    
    // Show table section
    document.getElementById('tableSection').style.display = 'block';
}


// Close modal
function closeHexagramModal() {
    document.getElementById('hexagramModal').style.display = 'none';
}

// Attach event listeners
document.getElementById('flipBtn').addEventListener('click', handleFlipButton);

// Close modal when clicking the X button
document.querySelector('.modal-close').addEventListener('click', closeHexagramModal);

// Close modal when clicking outside the modal content
window.addEventListener('click', function(event) {
    const modal = document.getElementById('hexagramModal');
    if (event.target === modal) {
        closeHexagramModal();
    }
});
